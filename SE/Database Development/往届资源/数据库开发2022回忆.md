> wyh 2022.5.10

#### 一、关系理论

##### 1）为什么说关系数据库比层状/网状数据库更科学？

- 层次性数据库最早出现：存在逻辑嵌套，而不是线性排列，适用于部分场景，耦合性过强限制了我们对数据的自由操作；
- 网状数据库（多层次链接）：灵活很多，但是数据操作依然困难；
- 关系型数据库在灵活性、数据访问、数据的组织找到了很好的平衡点，说场景普适的存储方式，对于特定的存储不太合适；

##### 2）关系理论认为，数据中不应该有重复数据，记录之间也不存在顺序关系。在现实的关系型数据库中又是如何处理的？

关系理论不包含重复数据，不然无法保证一致性。然而很多中间结果集包含重复数据。因为：关系是处理无限数据集的，但是数据库处理的是有限数据集。有限数据集不仅需要保证正确，还需要提高效率。

额外：关系理论中，记录没有顺序。现实的关系型数据库中顺序存放记录使得效率提高；

##### 3）关系理论如何决定SQL优化的？请简要说明

#### 二、索引

##### 1）B树索引的结构和使用方式

有K个子树的中间结点包含K个元素，每个节点不保存数据只保存索引，所有的数据都存储在叶节点；

所有叶节点中包含了元素的信息，还有指向元素记录的指针，并且叶节点本身按照关键字大小从小到大的顺序连接；

使用方式是根据目标元素在B树中二分查找。

##### 2）何时该使用B树索引，并分别说明原因；并详细说明为什么系统的为外键构建索引是普遍的要求？

何时使用：

- 仅需要通过索引访问基本表的一部分（检索的结果集与集体的百分比低于10%）
- 如果处理表的多列，可以使用索引而不使用表；

为什么系统的为外键构建索引是普遍的要求：

- 建立外键索引可以更快速地保证数据的一致性：比如A持有B的外键，B删除记录时需要检查A中相应的行；否则，需要对A全表遍历；
- 建立外键索引可以避免死锁：如上所述，对A全表遍历时间很长，导致其他进程与之死锁，导致双双失败；

##### 针对2）有没有例外情况？如果有请简要说明情况

如果表很小或者很少被修改，则不必建立；因为使用索引非常占用磁盘空间；

##### 3）哈希索引的结构和使用范围

结构：对索引键值进行哈希计算，将得到的结果作为键值创建索引；

使用范围：支持全键值查询、=、in、不等于等运算；不支持部分键值匹配、排序；

##### 4）除此以外还有哪些索引？简要说明结构和使用范围。

#### 三、事务

##### 1）事务隔离级别有哪些？简要说明脏读、不可重复读、幻读的情况，举例说明。

##### 2）简述MVCC省略的隔离级别。简述版本号逻辑。简述SELECT、INSERT、DELETE、UPDATE的版本号。

##### 3）理论上，可重复读不可以避免幻读，但实际上几乎不会产生幻读，正确吗？举例说明。

#### 四、高并发和大数据

##### 1）锁的解决方案是什么样的？

- 不要随便使用表级锁，尽量使用细粒度锁；
- 只有使用了索引才能使用行锁；
- 尽量缩短加锁时间
- 避免SQL上的循环处理；
- 减少程序和数据库之间的交互次数；
- 先roll back，提前释放锁；

##### 解决资源竞争的方法有哪些？

- DBA解决方案：与业务逻辑弱相关或无关
  - 事务空间：调整事物锁占空间的大小，事务条目占用是重要原因，DBA可以增加分配给事务条目的空间来解决；
  - 可用列表：insert操作在不同物理块中，可以借助存储管理手段；
- 架构解决方案：
  - 分区；
  - 逆序索引；减少竞争点
  - 索引组织表：原本资源竞争包括基本表和索引，但是现在索引和基本表合并了，可以降低冲突发生的位置；
- 开发解决方案
  - 调节并发数：限制最高的session数量；多加session反倒会增加管理成本；
  - 不适用系统产生键：如果键没有意义，不妨使用随机值，range需要足够大；碰撞

##### 2）数据量增长对于大数据的影响：几乎不影响、线性影响、非线性影响

#### 五、SQL

次日/首日登录比率。作业原题。

#### 六、SQL

部门前三高工资。作业原题。

#### 七、附加题

##### 1）关系型数据库、数据仓库、NoSQL的演化过程和内在联系；

##### 2）哪个知识点最印象深刻？为什么？

